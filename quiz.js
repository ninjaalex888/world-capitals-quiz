
const data = [
  {
    "country": "France",
    "capital": "Paris",
    "options": [
      "Rome",
      "Oslo",
      "Berlin",
      "Lisbon",
      "Paris"
    ]
  },
  {
    "country": "Germany",
    "capital": "Berlin",
    "options": [
      "Vienna",
      "Berlin",
      "Lisbon",
      "Budapest",
      "Warsaw"
    ]
  },
  {
    "country": "Spain",
    "capital": "Madrid",
    "options": [
      "Madrid",
      "Vienna",
      "Copenhagen",
      "Oslo",
      "Paris"
    ]
  },
  {
    "country": "Italy",
    "capital": "Rome",
    "options": [
      "Rome",
      "Budapest",
      "Oslo",
      "London",
      "Vienna"
    ]
  },
  {
    "country": "Portugal",
    "capital": "Lisbon",
    "options": [
      "Lisbon",
      "Vienna",
      "London",
      "Oslo",
      "Berlin"
    ]
  },
  {
    "country": "Poland",
    "capital": "Warsaw",
    "options": [
      "Warsaw",
      "Vienna",
      "Madrid",
      "Prague",
      "London"
    ]
  },
  {
    "country": "Hungary",
    "capital": "Budapest",
    "options": [
      "Rome",
      "Lisbon",
      "London",
      "Budapest",
      "Madrid"
    ]
  },
  {
    "country": "Norway",
    "capital": "Oslo",
    "options": [
      "Prague",
      "Lisbon",
      "Copenhagen",
      "Oslo",
      "Warsaw"
    ]
  },
  {
    "country": "Sweden",
    "capital": "Stockholm",
    "options": [
      "Berlin",
      "Warsaw",
      "Copenhagen",
      "Vienna",
      "Stockholm"
    ]
  },
  {
    "country": "Netherlands",
    "capital": "Amsterdam",
    "options": [
      "Amsterdam",
      "Madrid",
      "Budapest",
      "Oslo",
      "Rome"
    ]
  },
  {
    "country": "China",
    "capital": "Beijing",
    "options": [
      "Beijing",
      "Tokyo",
      "Kuala Lumpur",
      "Manila",
      "Colombo"
    ]
  },
  {
    "country": "Japan",
    "capital": "Tokyo",
    "options": [
      "Colombo",
      "Tokyo",
      "Bangkok",
      "Kathmandu",
      "Kuala Lumpur"
    ]
  },
  {
    "country": "South Korea",
    "capital": "Seoul",
    "options": [
      "Seoul",
      "Beijing",
      "New Delhi",
      "Hanoi",
      "Colombo"
    ]
  },
  {
    "country": "Thailand",
    "capital": "Bangkok",
    "options": [
      "Seoul",
      "Manila",
      "Colombo",
      "Bangkok",
      "Jakarta"
    ]
  },
  {
    "country": "Malaysia",
    "capital": "Kuala Lumpur",
    "options": [
      "Beijing",
      "Kathmandu",
      "Kuala Lumpur",
      "Bangkok",
      "Manila"
    ]
  },
  {
    "country": "Indonesia",
    "capital": "Jakarta",
    "options": [
      "Kathmandu",
      "Hanoi",
      "Kuala Lumpur",
      "Jakarta",
      "Manila"
    ]
  },
  {
    "country": "Philippines",
    "capital": "Manila",
    "options": [
      "Kuala Lumpur",
      "Tokyo",
      "Bangkok",
      "Manila",
      "Colombo"
    ]
  },
  {
    "country": "India",
    "capital": "New Delhi",
    "options": [
      "New Delhi",
      "Bangkok",
      "Beijing",
      "Tokyo",
      "Jakarta"
    ]
  },
  {
    "country": "Nepal",
    "capital": "Kathmandu",
    "options": [
      "Kathmandu",
      "Beijing",
      "Bangkok",
      "Colombo",
      "New Delhi"
    ]
  },
  {
    "country": "Sri Lanka",
    "capital": "Colombo",
    "options": [
      "New Delhi",
      "Kuala Lumpur",
      "Bangkok",
      "Jakarta",
      "Colombo"
    ]
  },
  {
    "country": "Egypt",
    "capital": "Cairo",
    "options": [
      "Kampala",
      "Cairo",
      "Nairobi",
      "Lagos",
      "Dakar"
    ]
  },
  {
    "country": "Kenya",
    "capital": "Nairobi",
    "options": [
      "Nairobi",
      "Addis Ababa",
      "Harare",
      "Kampala",
      "Tripoli"
    ]
  },
  {
    "country": "Nigeria",
    "capital": "Abuja",
    "options": [
      "Tripoli",
      "Cairo",
      "Harare",
      "Accra",
      "Abuja"
    ]
  },
  {
    "country": "Ghana",
    "capital": "Accra",
    "options": [
      "Accra",
      "Dakar",
      "Harare",
      "Cairo",
      "Algiers"
    ]
  },
  {
    "country": "Senegal",
    "capital": "Dakar",
    "options": [
      "Harare",
      "Dakar",
      "Kampala",
      "Tripoli",
      "Nairobi"
    ]
  },
  {
    "country": "Ethiopia",
    "capital": "Addis Ababa",
    "options": [
      "Lagos",
      "Kampala",
      "Addis Ababa",
      "Nairobi",
      "Algiers"
    ]
  },
  {
    "country": "Uganda",
    "capital": "Kampala",
    "options": [
      "Kampala",
      "Harare",
      "Nairobi",
      "Tripoli",
      "Cairo"
    ]
  },
  {
    "country": "Zimbabwe",
    "capital": "Harare",
    "options": [
      "Addis Ababa",
      "Cairo",
      "Algiers",
      "Nairobi",
      "Harare"
    ]
  },
  {
    "country": "Algeria",
    "capital": "Algiers",
    "options": [
      "Algiers",
      "Harare",
      "Nairobi",
      "Tripoli",
      "Dakar"
    ]
  },
  {
    "country": "Libya",
    "capital": "Tripoli",
    "options": [
      "Addis Ababa",
      "Tripoli",
      "Lagos",
      "Algiers",
      "Nairobi"
    ]
  },
  {
    "country": "USA",
    "capital": "Washington D.C.",
    "options": [
      "Lima",
      "Bogot\u00e1",
      "Montevideo",
      "Washington D.C.",
      "Santiago"
    ]
  },
  {
    "country": "Canada",
    "capital": "Ottawa",
    "options": [
      "Ottawa",
      "Washington D.C.",
      "Bogot\u00e1",
      "Lima",
      "Buenos Aires"
    ]
  },
  {
    "country": "Mexico",
    "capital": "Mexico City",
    "options": [
      "Quito",
      "Bogot\u00e1",
      "Montevideo",
      "Buenos Aires",
      "Mexico City"
    ]
  },
  {
    "country": "Brazil",
    "capital": "Bras\u00edlia",
    "options": [
      "Buenos Aires",
      "Ottawa",
      "Bogot\u00e1",
      "Lima",
      "Bras\u00edlia"
    ]
  },
  {
    "country": "Argentina",
    "capital": "Buenos Aires",
    "options": [
      "Washington D.C.",
      "Mexico City",
      "Bogot\u00e1",
      "Buenos Aires",
      "Bras\u00edlia"
    ]
  },
  {
    "country": "Chile",
    "capital": "Santiago",
    "options": [
      "Montevideo",
      "Mexico City",
      "Santiago",
      "Washington D.C.",
      "Bogot\u00e1"
    ]
  },
  {
    "country": "Colombia",
    "capital": "Bogot\u00e1",
    "options": [
      "Santiago",
      "Mexico City",
      "Lima",
      "Bogot\u00e1",
      "Montevideo"
    ]
  },
  {
    "country": "Peru",
    "capital": "Lima",
    "options": [
      "Ottawa",
      "Bogot\u00e1",
      "Lima",
      "Santiago",
      "Washington D.C."
    ]
  },
  {
    "country": "Uruguay",
    "capital": "Montevideo",
    "options": [
      "Washington D.C.",
      "Montevideo",
      "Santiago",
      "Lima",
      "Mexico City"
    ]
  },
  {
    "country": "Ecuador",
    "capital": "Quito",
    "options": [
      "Montevideo",
      "Santiago",
      "Mexico City",
      "Quito",
      "Washington D.C."
    ]
  },
  {
    "country": "Australia",
    "capital": "Canberra",
    "options": [
      "Suva",
      "Melbourne",
      "Canberra",
      "Port Moresby",
      "Sydney"
    ]
  },
  {
    "country": "New Zealand",
    "capital": "Wellington",
    "options": [
      "Suva",
      "Port Moresby",
      "Wellington",
      "Sydney",
      "Melbourne"
    ]
  },
  {
    "country": "Fiji",
    "capital": "Suva",
    "options": [
      "Melbourne",
      "Auckland",
      "Sydney",
      "Canberra",
      "Suva"
    ]
  },
  {
    "country": "Papua New Guinea",
    "capital": "Port Moresby",
    "options": [
      "Melbourne",
      "Sydney",
      "Auckland",
      "Canberra",
      "Port Moresby"
    ]
  }
];

let currentQuestion = 0;
let correctAnswers = 0;
let totalQuestions = 10;
let order = [];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function startQuiz() {
  order = [...Array(data.length).keys()];
  shuffle(order);
  currentQuestion = 0;
  correctAnswers = 0;
  const lengthDropdown = document.getElementById("quiz-length");
  const customInput = document.getElementById("custom-amount");
  const custom = parseInt(customInput.value);
  totalQuestions = custom > 0 ? custom : parseInt(lengthDropdown.value);
  document.getElementById("intro-card").style.display = "none";
  document.getElementById("quiz-section").style.display = "block";
  loadQuestion();
}

function loadQuestion() {
  const q = data[order[currentQuestion]];
  document.getElementById("country-name").textContent = q.country;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  q.options.forEach(option => {
    const btn = document.createElement("button");
    btn.textContent = option;
    btn.className = "option-btn";
    btn.onclick = () => checkAnswer(option, q.capital);
    optionsDiv.appendChild(btn);
  });
  document.getElementById("result").textContent = "";
  document.getElementById("next-btn").style.display = "none";
}

function checkAnswer(selected, correct) {
  const buttons = document.querySelectorAll(".option-btn");
  buttons.forEach(btn => btn.disabled = true);
  const result = document.getElementById("result");
  if (selected === correct) {
    result.textContent = "✅ Correct!";
    result.style.color = "#22c55e";
    correctAnswers++;
  } else {
    result.textContent = `❌ Incorrect. Correct: ${correct}`;
    result.style.color = "#ef4444";
  }
  document.getElementById("next-btn").style.display = "inline-block";
}

document.addEventListener("DOMContentLoaded", () => {
  const startBtn = document.getElementById("start-btn");
  if (startBtn) {
    startBtn.addEventListener("click", startQuiz);
  }

  const nextBtn = document.getElementById("next-btn");
  if (nextBtn) {
    nextBtn.addEventListener("click", () => {
      currentQuestion++;
      if (currentQuestion < totalQuestions) {
        loadQuestion();
      } else {
        const username = document.getElementById("username").value.trim() || "guest";
        const scoreData = {
          score: correctAnswers,
          total: totalQuestions,
          timestamp: new Date().toISOString()
        };
        if (username !== "guest") {
          firebase.firestore().collection("users").doc(username).collection("scores").add(scoreData);
        }
        document.getElementById("quiz-section").innerHTML = `
          <h2>🎉 Quiz Finished!</h2>
          <p>Score: ${correctAnswers} / ${totalQuestions}</p>
          <a href="leaderboard.html">View Leaderboard</a>
        `;
      }
    });
  }
});
